# 🎞 Block Master

`Block Master` is an educational project designed to manage high quality films.

The project addresses several highlights:

***Integration Testing with SpecFlow and Test Containers:***

Integration testing has been implemented using SpecFlow with a focus on test containers to ensure system robustness and
reliability.

***Infrastructure as Code with AWS CDK:***

Infrastructure build is done using AWS CDK (Cloud Development Kit) to efficiently and reproducibly deploy the
application.

***Clean Code and Cloud Services:***

Clean code best practices are followed to maintain readable and maintainable code.
Cloud services such as Lambda, ElastiCache and API Gateway are leveraged to improve system scalability and performance.

***Authentication with JWT for Microservices:***

JWT-based authentication concepts are implemented to ensure security in microservices, strengthening the protection of
sensitive data.
Swagger and API Service Customization:

***Swagger is used to document and visualize API services.***

Customizations, such as path prefixes and versioning, are applied to improve API structure and maintainability.
This project is a valuable resource for learning and applying modern development, software architecture and deployment
practices for cloud applications. Explore and experiment with `Block Master`!

## Table of Contents

1. How to run
2. Testing
4. Architecture diagram
4. Swagger
3. API

## How to run

For run this project you need the next requirements.

- [.NET Core 6.0 Version](https://dotnet.microsoft.com/en-us/download).
- [Docker](https://docs.docker.com/get-docker/).

The BlockMaster.Api project contains the program class and the API configuration
through the launchSettings.json file to be executed. In this folder you have to execute
the following command.

        dotnet run

You will see the next logs.

    info: Microsoft.Hosting.Lifetime[14]
    Now listening on: https://localhost:5000
    info: Microsoft.Hosting.Lifetime[0]
    Application started. Press Ctrl+C to shut down.
    info: Microsoft.Hosting.Lifetime[0]
    Hosting environment: Development
    info: Microsoft.Hosting.Lifetime[0]
    Content root path: C:\yourDirectory\BlockMaster\BlockMaster.Api\

## Testing

`Block Master`has a testing section composed of integration tests
that allow evaluating the behavior of the application prior to its main execution.

***It is important to have docker running beforehand***.

    dotnet test

You will see the next logs (Example).

           Determining projects to restore...
           All projects are up-to-date for restore.
           BlockMaster.Domain -> C:\yourDirectory\BlockMaster\BlockMaster.Domain\bin\Debug\net6.0\
           BlockMaster.Domain.dll
           BlockMaster.Business -> C:\yourDirectory\BlockMaster\BlockMaster.Business\bin\Deb
           ug\net6.0\BlockMaster.Business.dll
           BlockMaster.Infrastructure -> C:\yourDirectory\BlockMaster\main\BlockMaster.Infrastructure\b
           in\Debug\net6.0\BlockMaster.Infrastructure.dll
           BlockMaster.Api -> C:\yourDirectory\BlockMaster\BlockMaster.Api\bin\Debug\net6.0\BlockMaster.Api.dll
           test -> C:\yourDirectory\BlockMaster\Tests\bin\Debug\net6.0\test.dll
           Test run for C:\yourDirectory\BlockMaster\Tests\bin\Debug\net6.0\test.dll (.NETCoreApp,Version=v6.0)
           Microsoft (R) Test Execution Command Line Tool Version 17.5.0 (x64)
           Copyright (c) Microsoft Corporation.  All rights reserved.

           Starting test execution, please wait...
           A total of 1 test files matched the specified pattern.

           Passed!  - Failed:     0, Passed:    30, Skipped:     0, Total:    17, Duration: 29 s - test.dll (net6.0)

## Architecture diagram

![architectureDiagram](Resources/architectureDiagram.png)

## Swagger

The project presents a Swagger user interface (UI) that facilitates the interaction and consumption of the microservice
in a comfortable and interactive way. Through this interface, you can consume the various endpoints of the service. It
is important to note that, initially, you must use authentication through the `identity/token` service. You can consume
this service using the following command, as indicated in the next section.

The login URL is:

`https://localhost:5000/block-master/swagger/index.html`

## API

`Block Master` can implement the following actions for movies.

1. Create a movie.
2. Edit a movie.
3. Get a movie.
4. Search all existing movies.
5. Delete a movie.

**Note: Please note that to do the endpoint consumption it is important to send the authentication header with a JWT
token generated by the `identity/token` endpoint.**

***It is important that the steps to be taken for the categories must be within those allowed in the following list.***

```json
{
  Adventure,
  Comedy,
  Drama,
  Documentary,
  Music,
  Romance,
  Mystery,
  ScienceFiction,
  Horror,
  Fantasy,
  Animation,
  Crime,
  Thriller,
  History,
  War,
  Sport,
  Western,
  Biography,
  Family,
  Action
}
```

### 1. Check microservice is alive

*Request*

Method: `GET`<br>
URL: `http://localhost:5000/block-master/v1/movies/ping`

*Response*

    pong

### 2. Create JWT token

`Block Master` posee el uso de tokens JWT para los procesos de autenticación y autorización en los distintos endpoints.

*Request*

Method: `POST`<br>
URL: `http://localhost:5000/block-master/v1/identity/token`

Body:

```json
{
  "userid": "8a3bbfd4-5bbd-4f8e-8b22-6a066d471bf5",
  "email": "user@mail.com",
  "customClaims": {
    "admin": "true"
  }
}
```

*Response*

```json
  {
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI0MjAwYmUyOC02ODJjLTQxNDMtYTgzZC0zNjljZDQ1NTE5NzkiLCJzdWIiOiJ5c25hbGRzdGVyQG1haWwuY29tIiwiZW1haWwiOiJ5c25hbGRzdGVyQG1haWwuY29tIiwidXNlcmlkIjoiOGEzYmJmZDQtNWJiZC00ZjhlLThiMjItNmEwNjZkNDcxYmY1IiwiYWRtaW4iOiJhZG1pbiIsIm5iZiI6MTcwMTA0ODk1NCwiZXhwIjoxNzAxMDc3NzU0LCJpYXQiOjE3MDEwNDg5NTQsImlzcyI6Imh0dHA6Ly9sb2NhbGhvc3Q6NTAwMC8iLCJhdWQiOiJodHRwOi8vbG9jYWxob3N0OjUwMDAvIn0._3J5laKCdSlkhCdrzWeYnOt-2fKrHBSXrf4n8IxNt9s"
}
```

### 3. Create a movie

*Request*

Method: `POST`<br>
URL: `http://localhost:5000/block-master/v1/movies`

Body:

```json
    {
  "id": 1,
  "name": "Test1",
  "description": "Test1",
  "score": 3.5,
  "category": "Test1"
}
```

*Response*

```json
    {
  "id": 1,
  "name": "Test1",
  "description": "Test1",
  "score": 3.5,
  "category": "Test1"
}
```

### 4. Get movies

*Request*

Method: `GET`<br>
URL: `http://localhost:5000/block-master/v1/movies`

*Response*

```json
    [
  {
    "id": 3,
    "name": "Test3",
    "description": "Test2",
    "score": 3.5,
    "category": "Test2"
  },
  {
    "id": 2,
    "name": "Test2",
    "description": "Test2",
    "score": 3.5,
    "category": "Test2"
  }
]
```

### 5. Get a movie

*Request*

Method: `GET`<br>
URL: `http://localhost:5000/block-master/v1/movies/{movieName}`

*Response*

```json
    {
  "id": 1,
  "name": "Test1",
  "description": "Test1",
  "score": 2.5,
  "category": "Test1"
}
```

### 6. Update a movie

*Request*

Method: `PUT`<br>
URL: `http://localhost:5000/block-master/v1/movies/{movieName}`

Body:

```json
    {
  "name": "Test4",
  "description": "Test4",
  "score": 3.5,
  "category": "Test4"
}
```

*Response*

```json
    {
  "id": 1,
  "name": "Test4",
  "description": "Test4",
  "score": 3.5,
  "category": "Test4"
}
```

### 7. Delete a movie

*Request*

Method: `DELETE`<br>
URL: `http://localhost:5000/block-master/v1/movies/{movieName}`

*Response*

```json
    {
  "id": 1,
  "name": "Test4",
  "description": "Test4",
  "score": 3.5,
  "category": "Test4"
}
```